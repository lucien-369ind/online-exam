<?php 
require_once 'functions.php'; 

$subject = $_GET['subject'] ?? '';
if (!in_array($subject, $validSubjects)) {
    die('Invalid subject.');
}

$questions = loadQuestions($subject);

if (empty($questions)) {
    $message = "No questions available for $subject. Please contact admin.";
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo ucfirst($subject); ?> Exam</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="quiz-container">
        <h2><?php echo ucfirst($subject); ?> MCQ Exam</h2>
        <p><a href="index.php" class="back-link">‚Üê Back to Home</a></p>
        
        <?php if (empty($questions)): ?>
            <p class="error"><?php echo $message; ?></p>
        <?php else: ?>
            <p class="question-count">Number of Questions: <?php echo count($questions); ?></p>
            
            <form id="quizForm">
                <?php foreach ($questions as $index => $q): ?>
                    <div class="question">
                        <label><?php echo $index + 1; ?>. <?php echo htmlspecialchars($q['question_text']); ?></label>
                        <div class="options">
                            <label><input type="radio" name="q<?php echo $index + 1; ?>" value="A"> <?php echo htmlspecialchars($q['option_a']); ?></label>
                            <label><input type="radio" name="q<?php echo $index + 1; ?>" value="B"> <?php echo htmlspecialchars($q['option_b']); ?></label>
                            <label><input type="radio" name="q<?php echo $index + 1; ?>" value="C"> <?php echo htmlspecialchars($q['option_c']); ?></label>
                            <label><input type="radio" name="q<?php echo $index + 1; ?>" value="D"> <?php echo htmlspecialchars($q['option_d']); ?></label>
                        </div>
                        <input type="hidden" class="correct-answer" data-q="<?php echo $index + 1; ?>" value="<?php echo $q['correct_option']; ?>">
                    </div>
                <?php endforeach; ?>
                
                <button type="button" class="submit-btn" onclick="checkQuiz('quizForm', <?php echo count($questions); ?>)">Submit Quiz</button>
            </form>
            
            <div id="result"></div>
        <?php endif; ?>
    </div>

    <script src="script.js"></script>
</body>
</html>